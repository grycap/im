openapi: 3.0.3
info:
  contact:
    name: EOSC
    url: https://open-science-cloud.ec.europa.eu/
  description: Deployment service for European Open Science Cloud nodes
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  title: EOSC Application Workflow Management API
  version: 0.1.45
servers:
- url: https://localhost:8080
  description: Local development server
components:
  schemas:
    Allocation:
      discriminator:
        propertyName: kind
      oneOf:
      - $ref: '#/components/schemas/EoscNodeEnvironment'
      - $ref: '#/components/schemas/OpenStackEnvironment'
      - $ref: '#/components/schemas/KubernetesEnvironment'
    AllocationId:
      description: Where to deploy
      properties:
        id:
          description: Unique identifier for this allocation
          type: string
        infoLink:
          description: Endpoint that returns more details about this allocation
          format: url
          type: string
        kind:
          default: AllocationId
          type: string
      required:
      - id
      - infoLink
      type: object
    AllocationInfo:
      allOf:
      - $ref: '#/components/schemas/Allocation'
      - properties:
          id:
            description: Unique identifier for this allocation
            type: string
          self:
            description: Endpoint that returns the details of this allocation
            format: url
            type: string
        required:
        - id
        - self
        type: object
    Date:
      example: 2025-02-17
      format: date
      type: string
    Deployment:
      properties:
        allocation:
          $ref: '#/components/schemas/AllocationId'
        tool:
          $ref: '#/components/schemas/ToolId'
      required:
      - tool
      - allocation
      type: object
    DeploymentId:
      properties:
        id:
          description: Unique identifier for this deployment
          type: string
        infoLink:
          description: Endpoint that returns more details about this deployment
          format: url
          type: string
        kind:
          default: DeploymentId
          type: string
      required:
      - id
      - infoLink
      type: object
    DeploymentInfo:
      allOf:
      - $ref: '#/components/schemas/Deployment'
      - properties:
          id:
            description: Unique identifier for this deployment
            type: string
          kind:
            default: DeploymentInfo
            type: string
          self:
            description: Endpoint that returns the details of this deployment
            format: url
            type: string
          status:
            enum:
            - unknown
            - pending
            - running
            - stopped
            - off
            - failed
            - configured
            - unconfigured
            - deleting
            type: string
        required:
        - id
        - self
        type: object
    EoscNodeEnvironment:
      properties:
        awmAPI:
          description: "Base URL for the AWM API of the EOSC node where this environment\
            \ was allocated, \nor null for environments private to the calling user\
            \ that are accessed via \nexplicit credentials"
          format: url
          type: string
        expiresOn:
          example: 2025-02-17T14:27:01.000+0100
          format: date-time
          type: string
        hostname:
          format: url
          type: string
        kind:
          default: EoscNodeEnvironment
          type: string
        nodeId:
          description: Unique identifier of the EOSC node where this environment was
            allocated
          type: string
        nodeName:
          description: Name of the EOSC node where this environment was allocated
          type: string
        nodeUI:
          description: URL to the interactive UI of the EOSC node where this environment
            was allocated
          format: url
          type: string
        offer:
          properties:
            bulkStorage:
              description: HDD based (slow) storage quota in GB
              type: integer
            cpus:
              minimum: 1
              type: integer
            creditsPerDay:
              minimum: 1
              type: integer
            fastStorage:
              description: SSD or NVMe based (fast) storage quota in GB
              type: integer
            gpus:
              type: integer
            memory:
              description: RAM quota in GB
              minimum: 1
              type: integer
            offerId:
              type: string
            offerName:
              type: string
            offerType:
              enum:
              - openstack
              - kubernetes
              type: string
            registryStorage:
              description: Container Registry storage quota in GB
              type: integer
            s3Storage:
              description: S3 storage quota in GB
              type: integer
          required:
          - offerId
          - offerType
          type: object
        projectId:
          type: string
        provisionedOn:
          example: 2025-02-17T14:27:01.000+0100
          format: date-time
          type: string
      required:
      - kind
      - offer
      - nodeId
      - projectId
      - awmApi
      type: object
    Error:
      properties:
        description:
          description: Error message
          type: string
        details:
          additionalProperties:
            type: string
          description: Additional details about the error
          type: object
        id:
          description: Error type
          type: string
      type: object
    KubernetesEnvironment:
      properties:
        host:
          format: url
          type: string
        kind:
          default: KubernetesEnvironment
          type: string
      required:
      - kind
      - host
      type: object
    OpenStackEnvironment:
      properties:
        apiVersion:
          type: string
        authVersion:
          enum:
          - 3.x-oidc
          type: string
        domain:
          format: hostname
          type: string
        domainId:
          type: string
        host:
          format: url
          type: string
        kind:
          default: OpenStackEnvironment
          type: string
        region:
          type: string
        tenant:
          type: string
        tenantId:
          type: string
        userName:
          type: string
      required:
      - kind
      - host
      - authVersion
      type: object
    Page:
      properties:
        count:
          description: Total number of elements
          type: integer
        from:
          description: Index of the first returned element
          type: integer
        limit:
          description: Maximum number of elements to return at once
          type: integer
        nextPage:
          description: Endpoint that returns the next page
          format: url
          type: string
        prevPage:
          description: Endpoint that returns the previous page
          format: url
          type: string
        self:
          description: Endpoint that returned this page
          format: url
          type: string
      required:
      - from
      - limit
      - count
      type: object
    PageOfAllocations:
      allOf:
      - $ref: '#/components/schemas/Page'
      - properties:
          elements:
            items:
              $ref: '#/components/schemas/AllocationInfo'
            type: array
        required:
        - elements
        type: object
    PageOfDeployments:
      allOf:
      - $ref: '#/components/schemas/Page'
      - properties:
          elements:
            items:
              $ref: '#/components/schemas/DeploymentInfo'
            type: array
        required:
        - elements
    PageOfTools:
      allOf:
      - $ref: '#/components/schemas/Page'
      - properties:
          elements:
            items:
              $ref: '#/components/schemas/ToolInfo'
            type: array
        required:
        - elements
        type: object
    Success:
      properties:
        message:
          description: Confirmation message
          type: string
      type: object
    ToolId:
      description: What to deploy
      properties:
        id:
          description: Unique identifier for this tool blueprint
          type: string
        infoLink:
          description: URL that returns the full details of this tool blueprint version
          format: url
          type: string
        kind:
          default: ToolId
          type: string
        version:
          description: The specific version of this blueprint version
          type: string
      required:
      - id
      - version
      - infoLink
      type: object
    ToolInfo:
      properties:
        authorEmail:
          format: email
          type: string
        authorName:
          type: string
        blueprint:
          description: Prescriptive IaC script of the tool's workload
          type: string
        blueprintType:
          default: tosca
          enum:
          - tosca
          - ansible
          - helm
          type: string
        description:
          type: string
        favorite:
          default: false
          type: boolean
        helpdesk:
          format: url
          type: string
        id:
          description: Unique identifier for this tool blueprint
          type: string
        keywords:
          items:
            type: string
          type: array
        kind:
          default: ToolInfo
          type: string
        license:
          type: string
        name:
          type: string
        nodeId:
          description: Unique identifier of the EOSC node where this tool blueprint
            is hosted
          type: string
        organisation:
          type: string
        published:
          default: false
          type: boolean
        repository:
          format: url
          type: string
        self:
          description: Endpoint that returns the details of this tool blueprint
          format: url
          type: string
        type:
          enum:
          - vm
          - container
          type: string
        validated:
          type: boolean
        validatedOn:
          example: 2025-02-17T14:27:01.000+0100
          format: date-time
          type: string
        version:
          description: The blueprint version used in a deployment
          type: string
        versionFrom:
          description: The modified datetime of the blueprint version used in a deployment
          example: 2025-02-17T14:27:01.000+0100
          format: date-time
          type: string
        versionLatest:
          description: The latest version of the blueprint
          type: string
      required:
      - type
      - blueprint
      - blueprintType
      type: object
    Version:
      type: string
  securitySchemes:
    OIDC:
      bearerFormat: JWT
      description: OpenID Connect access token issued by EOSC AAI
      scheme: bearer
      type: http

paths:
  /allocation/{allocationId}:
    delete:
      operationId: deleteAllocation
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
          description: Deleted
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        409:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: In use
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Remove existing environment of the user
      tags:
      - Allocations
    get:
      operationId: getAllocationInfo
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllocationInfo'
          description: Success
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Retrieve information about an environment available to the user
      tags:
      - Allocations
    parameters:
    - in: path
      name: allocationId
      required: true
      schema:
        type: string
    put:
      operationId: updateAllocation
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Allocation'
        required: true
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllocationInfo'
          description: Updated
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        409:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: In use
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Update existing environment of the user
      tags:
      - Allocations
  /allocations:
    get:
      operationId: listAllocations
      parameters:
      - description: Index of the first element to return
        in: query
        name: from
        schema:
          default: 0
          minimum: 0
          type: integer
      - description: Maximum number of elements to return
        in: query
        name: limit
        schema:
          default: 100
          minimum: 1
          type: integer
      - in: query
        name: allNodes
        required: true
        schema:
          default: false
          type: boolean
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageOfAllocations'
          description: Success
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: List all environments available to the user
      tags:
      - Allocations
    post:
      operationId: recordAllocation
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Allocation'
        required: true
      responses:
        201:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AllocationId'
          description: Recorded
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Record an environment of the user
      tags:
      - Allocations
  /deployment/{deploymentId}:
    delete:
      operationId: deleteDeployment
      responses:
        202:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
          description: Deleting
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Tear down an existing deployment
      tags:
      - Deployments
    get:
      operationId: getDeployment
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentInfo'
          description: Accepted
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Get information about an existing deployment
      tags:
      - Deployments
    parameters:
    - in: path
      name: deploymentId
      required: true
      schema:
        type: string
  /deployments:
    get:
      operationId: listDeployments
      parameters:
      - description: Index of the first element to return
        in: query
        name: from
        schema:
          default: 0
          minimum: 0
          type: integer
      - description: Maximum number of elements to return
        in: query
        name: limit
        schema:
          default: 100
          minimum: 1
          type: integer
      - in: query
        name: allNodes
        required: true
        schema:
          default: false
          type: boolean
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageOfDeployments'
          description: Success
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: List existing deployments
      tags:
      - Deployments
    post:
      operationId: deployWorkload
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Deployment'
        required: true
      responses:
        202:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentId'
          description: Deploying
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: 'Deploy workload to an environment for which the user has credentials

        '
      tags:
      - Deployments
  /tool/{toolId}:
    get:
      operationId: getTool
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolInfo'
          description: Success
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        404:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Not found
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: Get information about a tool blueprint
      tags:
      - Tools
    parameters:
    - in: path
      name: toolId
      required: true
      schema:
        type: string
    - description: If missing, the latest version will be returned
      in: query
      name: version
      required: false
      schema:
        type: string
  /tools:
    get:
      operationId: listTools
      parameters:
      - description: Index of the first element to return
        in: query
        name: from
        schema:
          default: 0
          minimum: 0
          type: integer
      - description: Maximum number of elements to return
        in: query
        name: limit
        schema:
          default: 100
          minimum: 1
          type: integer
      - in: query
        name: allNodes
        schema:
          default: false
          type: boolean
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageOfTools'
          description: Success
        400:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Invalid parameters or configuration
        401:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Authorization required
        403:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Permission denied
        419:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Re-delegate credentials
        503:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
          description: Try again later
      security:
      - OIDC: []
      summary: List all tool blueprints
      tags:
      - Tools
  /version:
    get:
      operationId: version
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
          description: Success
      summary: Return service version information
      tags:
      - Service
